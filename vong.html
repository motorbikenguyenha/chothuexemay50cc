<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vòng quay may mắn</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background: #111;
    color: #fff;
  }
  canvas {
    margin-top: 20px;
    border-radius: 50%;
    background: #222;
  }
  button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 1.1rem;
    cursor: pointer;
    background: #EEAD0E;
    border: none;
    border-radius: 10px;
    color: #111;
    font-weight: bold;
  }
  #result {
    margin-top: 20px;
    font-size: 1.3rem;
    font-weight: bold;
    color: #FFD700;
  }
</style>
</head>
<body>

<h1 style="color:#EEAD0E;">Vòng quay may mắn</h1>
<canvas id="wheel" width="400" height="400"></canvas>
<button id="spinBtn">Quay vòng</button>
<div id="result"></div>

<script>
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spinBtn');
const resultDiv = document.getElementById('result');

const prizes = [
  "🎁 100k", "🍀 Thêm lượt", "🎉 50k", "💎 Quà VIP", 
  "🎊 200k", "🎫 Vé xem phim", "🥳 10k", "🏆 Quà lớn"
];

const colors = ["#EEAD0E","#FFD700","#FFC107","#FFB300",
                "#F9A825","#F57F17","#FFCA28","#FFEB3B"];

const numSlices = prizes.length;
const sliceAngle = (2 * Math.PI) / numSlices;

let rotation = 0; // góc hiện tại
let spinning = false;

function drawWheel() {
  const radius = canvas.width / 2;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(radius,radius);
  ctx.rotate(rotation);
  
  // Vẽ slice
  for(let i=0; i<numSlices; i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,radius, i*sliceAngle, (i+1)*sliceAngle);
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.strokeStyle = "#111";
    ctx.lineWidth = 2;
    ctx.stroke();
    
    // Vẽ chữ
    ctx.save();
    const angle = i*sliceAngle + sliceAngle/2;
    ctx.rotate(angle);
    ctx.textAlign = "right";
    ctx.fillStyle = "#111";
    ctx.font = "16px sans-serif";
    ctx.fillText(prizes[i], radius - 10, 5); // cách tâm 10px
    ctx.restore();
  }
  ctx.restore();
  
  // Kim cố định ở trên
  ctx.fillStyle = "#FF3D00";
  ctx.beginPath();
  ctx.moveTo(radius-5,0);
  ctx.lineTo(radius+5,0);
  ctx.lineTo(radius,radius/6);
  ctx.closePath();
  ctx.fill();
}

drawWheel();

function spinWheel() {
  if(spinning) return;
  spinning = true;
  resultDiv.textContent = "";

  const duration = 20000; // 20s
  const start = performance.now();
  const initialRotation = rotation;
  const spins = Math.random()*5 + 5; // quay thêm 5~10 vòng

  function animate(now){
    const elapsed = now - start;
    if(elapsed < duration){
      const t = elapsed / duration;
      // easing out (quay chậm dần)
      const eased = 1 - Math.pow(1-t, 3);
      rotation = initialRotation + eased * spins * 2*Math.PI;
      drawWheel();
      requestAnimationFrame(animate);
    } else {
      rotation = initialRotation + spins * 2*Math.PI;
      drawWheel();
      spinning = false;
      showResult();
    }
  }
  requestAnimationFrame(animate);
}

function showResult(){
  const normalizedRotation = rotation % (2*Math.PI);
  const index = numSlices - 1 - Math.floor(normalizedRotation / sliceAngle);
  const prize = prizes[index % numSlices];
  resultDiv.textContent = `🎉 Bạn trúng: ${prize}`;
}

spinBtn.addEventListener('click', spinWheel);
</script>

</body>
</html>
